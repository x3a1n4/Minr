@using teraRabbits

# @player Clicked a ghast!
@fast

# Get the block we're looking at
@define Block targetBlock = player.getTargetBlock(120)
# @player {{targetBlock.getLocation()}}

# Just set it to be a block for now
# @bypass /setblock {{targetBlock.getX()}} {{targetBlock.getY()}} {{targetBlock.getZ()}} minecraft:red_concrete

# Run functions based on tools named things
@define Item playerHeldItem = player.getItemInMainHand()
@define String itemType = playerHeldItem.getItemType().toLowerCase()
@define String itemName = playerHeldItem.getDisplayName()
@if itemName == null
    @var itemName = "Replace"
@fi
# Debug statement
# @var teraRabbitsUtils::log("Item: {{itemType}}, Name: {{itemName}}, Target Block: {{targetBlock}}")

# Get size, command
@define Int size = 0
@define String command = itemName
# @var teraRabbitsUtils::log("ItemName: {{itemName}}")
@if itemName.matches(".*\[.*\].*")
    @var size = Int(itemName.split("\[")[1].split("\]")[0])
    @var command = itemName.split("\[")[0].trim()
@fi

# Debug statement
# @var teraRabbitsUtils::log("Command: {{command}}, Size: {{size}}")

@using teraRabbitsTools
# Check if size is too big
@if (size > 5)
    @var teraRabbitsUtils::log("Size too big! Must be a maximum of 5")
@elseif (size < 0) 
    @player teraRabbitsUtils::log("Invalid size!")
@else
    @if (command == "Set Single Pattern")
        @var selectSingleBlockPattern(targetBlock)

    @elseif (command == "Sphere")
        @var sphere(targetBlock, size)
    @elseif (command == "Paint")
        @var paint(targetBlock, size)
    @elseif (command == "Erase")
        @var erase(targetBlock, size)

    @elseif (command == "Smooth")
        @var smooth(targetBlock, size)
    @elseif (command == "Pull")
        @var pull(targetBlock, player, size)
    @elseif (command == "Flatten")
        @var flatten(targetBlock, size)

    @elseif (command == "Cuboid Select")
        @var cuboidSelect(targetBlock)
    @elseif (command == "Cuboid Extend")
        @var cuboidExtend(targetBlock)

    @elseif (command == "Set")
        @var set(targetBlock)
    @elseif (command == "Copy")
        @var copy(targetBlock)
    @elseif (command == "Paste")
        @var paste(targetBlock)
    
    @elseif (command == "Stack")
        @var stack(player, size)

    @elseif (command == "Undo")
        @var undo()

    @elseif (command == "End")
        @var endSession(player)

    @elseif (command == "Spawn Rabbit")
        @var spawnRabbit(targetBlock)
    @else
        # By default, just replace block
        @var replace(targetBlock, playerHeldItem)
    @fi
@fi
